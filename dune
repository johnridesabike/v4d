(executable
 (public_name v4d)
 (name cli)
 (modules cli common data)
 (libraries gg vg))

(executable
 (name webapp)
 (modules webapp common data)
 (libraries gg vg vg.htmlc brr)
 (modes js)
 (js_of_ocaml
  (flags --target-env browser)))

(rule
 (mode promote)
 (action
  (with-stdout-to
   index.html
   (progn
    (echo
     "<!-- DO NOT EDIT THIS FILE. GENERATE IT WITH: dune build index.html -->\n")
    (cat %{dep:webapp.html})
    (echo "<script>\n")
    (cat %{dep:webapp.bc.js})
    (echo "</script>\n")))))

(cram
 (deps %{bin:v4d}))
